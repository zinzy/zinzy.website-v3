{{ define "main" }} {{ partial "back_link.html" .}}

<article class="h-entry prose prose-gray mb-14 dark:prose-invert">
  <header class="">
    <h2 class="p-name">{{ .Title }}</h2>
    {{ .Content }}
  </header>

  <section class="my-20">
      <form class="bg-gray-50 rounded-lg p-4" action="/submitted" method="POST" data-netlify="true" name="guestbook" netlify netlify-honeypot="not-for-humans">
        <p style="display: none;">
          <label>Don’t fill this out if you're human: <input name="not-for-humans" /></label>
        </p>
        <p class="m-0 p-0">
          <label>
            <div class="mb-1">
              <div>Name</div>
            </div>
            <input required class="p-2 rounded block w-full" placeholder="Kimmy Schmidt" type="text" name="name" />
          </label>
        </p>
        <p class="m-0 p-0">
          <label>
            
            <div class="mb-1">
              <div>Website</div>
            </div>
            <input class="p-2 rounded block w-full"  placeholder="https://unbreakab.le" type="text" name="website" /></label>
        </p>
        <p class="m-0 p-0">
          <label>
            <div class="mb-1">
              <div>Message</div>
            </div>
            <textarea name="message" placeholder="Hey Zinzy, I just wanted to say..." class="p-2 rounded block w-full min-h-28"></textarea></label>
        </p>
        <p class="m-0 p-0 text-right">
          <button type="submit" class="button">Submit</button>
        </p>
      </form>
  </section>

  <section id="guestbook-messages">
    <p>Loading guestbook entries...</p>
  </section>
  
  <script>
    fetch('/.netlify/functions/guestbook')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById("guestbook-messages");
        container.innerHTML = "";
  
        data.forEach(entry => {
          const li = document.createElement("li");
          li.innerHTML = `
          <div class="mb-5">${entry.data.message}</div>
          <div class="text-right">— ${entry.data.website ? 
              `<a href="${entry.data.website}" target="_blank">${entry.data.name}</a>` :
              `${entry.data.name}`
          }</div `;
          container.appendChild(li);
        }); 
      })
      .catch(error => {
        console.error("Error loading guestbook:", error);
      });
  </script>
  
  
  {{ partial "backlinks.html" . }}
</article>
{{ end }}
