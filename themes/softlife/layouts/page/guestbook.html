{{ define "main" }} {{ partial "back_link.html" .}}

<article class="h-entry prose prose-gray mb-14 dark:prose-invert">
  <header class="">
    <h2 class="p-name">{{ .Title }}</h2>
    {{ .Content }}
  </header>

  <form name="guestbook" method="POST" data-netlify="true">
    <input type="text" name="name" placeholder="Your name" required>
    <textarea name="message" placeholder="Your message" required></textarea>
    <button type="submit">Sign Guestbook</button>
  </form>

  <section>
    <div>
      <h2>Sign the guestbook</h2>
    
      <form action="/submitted" name="guestbook" netlify netlify-honeypot="not-for-humans">
        <p style="display: none;">
          <label>Donâ€™t fill this out if you're human: <input name="not-for-humans" /></label>
        </p>
        <p>
          <label>Name<br><input placeholder="Your name..." type="text" name="name" /></label>
        </p>
        <p>
          <label>Message<br><textarea name="message" placeholder="Your message..."></textarea></label>
        </p>
        <p>
          <button type="submit">Submit</button>
        </p>
      </form>
    </div>
  </section>

  <section id="guestbook-messages">
    <p>Loading guestbook entries...</p>
  </section>
  
  <script>
    fetch('/.netlify/functions/guestbook')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById("guestbook-messages");
        container.innerHTML = "";
  
        data.forEach(entry => {
          const div = document.createElement("div");
          div.innerHTML = `<p><strong>${entry.data.name}:</strong> ${entry.data.message}</p>`;
          container.appendChild(div);
        });
      })
      .catch(error => {
        console.error("Error loading guestbook:", error);
      });
  </script>
  
  
  {{ partial "backlinks.html" . }}
</article>
{{ end }}
